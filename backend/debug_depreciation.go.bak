package main

import (
	"fmt"
	"time"
)

// Fungsi untuk menghitung selisih bulan
func monthsDifference(startDate, endDate time.Time) int {
	if endDate.Before(startDate) {
		return 0
	}
	
	months := int(endDate.Month()) - int(startDate.Month())
	months += (endDate.Year() - startDate.Year()) * 12
	
	// Add partial month if end date day is >= start date day
	if endDate.Day() >= startDate.Day() {
		months++
	}
	
	return months
}

// Fungsi untuk menghitung straight line depreciation
func calculateStraightLineDepreciation(depreciableAmount float64, usefulLifeYears int, monthsSincePurchase int) float64 {
	monthlyDepreciation := depreciableAmount / float64(usefulLifeYears*12)
	return monthlyDepreciation * float64(monthsSincePurchase)
}

func main() {
	fmt.Println("=== Verifikasi Perhitungan Depresiasi ===")
	
	// Data asset yang kemungkinan ada (contoh)
	// Kita perlu cek asset apa yang ada di sistem
	
	// Contoh asset berdasarkan yang mungkin dibuat:
	// Asset dari purchase receipt dengan harga Rp 17.500.000
	
	// Skenario 1: Asset dengan harga 17.5 juta, useful life 5 tahun, salvage value 5 juta
	fmt.Println("\n--- Skenario 1: Asset Mesin Printer ---")
	purchasePrice := 17500000.0
	salvageValue := 5000000.0
	usefulLife := 5
	purchaseDate := time.Date(2025, 9, 12, 0, 0, 0, 0, time.UTC) // Hari ini
	currentDate := time.Now()
	
	depreciableAmount := purchasePrice - salvageValue
	monthsSince := monthsDifference(purchaseDate, currentDate)
	
	fmt.Printf("Purchase Price: Rp %.2f\n", purchasePrice)
	fmt.Printf("Salvage Value: Rp %.2f\n", salvageValue)
	fmt.Printf("Depreciable Amount: Rp %.2f\n", depreciableAmount)
	fmt.Printf("Useful Life: %d years\n", usefulLife)
	fmt.Printf("Purchase Date: %s\n", purchaseDate.Format("2006-01-02"))
	fmt.Printf("Current Date: %s\n", currentDate.Format("2006-01-02"))
	fmt.Printf("Months Since Purchase: %d\n", monthsSince)
	
	totalDepreciation := calculateStraightLineDepreciation(depreciableAmount, usefulLife, monthsSince)
	monthlyDepreciation := depreciableAmount / float64(usefulLife*12)
	
	fmt.Printf("Monthly Depreciation: Rp %.2f\n", monthlyDepreciation)
	fmt.Printf("Total Accumulated Depreciation: Rp %.2f\n", totalDepreciation)
	
	// Skenario 2: Asset yang dibeli lebih awal (misalnya 1 bulan lalu)
	fmt.Println("\n--- Skenario 2: Asset dibeli 1 bulan lalu ---")
	purchaseDate2 := time.Date(2025, 8, 12, 0, 0, 0, 0, time.UTC) // 1 bulan lalu
	monthsSince2 := monthsDifference(purchaseDate2, currentDate)
	totalDepreciation2 := calculateStraightLineDepreciation(depreciableAmount, usefulLife, monthsSince2)
	
	fmt.Printf("Purchase Date: %s\n", purchaseDate2.Format("2006-01-02"))
	fmt.Printf("Months Since Purchase: %d\n", monthsSince2)
	fmt.Printf("Total Accumulated Depreciation: Rp %.2f\n", totalDepreciation2)
	
	// Skenario 3: Asset dengan nilai yang menghasilkan Rp 262.500
	fmt.Println("\n--- Skenario 3: Mencari asset yang menghasilkan Rp 262.500 ---")
	targetDepreciation := 262500.0
	
	// Jika 1 bulan depresiasi = 262.500, maka:
	// monthlyDepreciation = 262.500
	// depreciableAmount / (usefulLife * 12) = 262.500
	// depreciableAmount = 262.500 * usefulLife * 12
	
	for life := 1; life <= 10; life++ {
		requiredDepreciableAmount := targetDepreciation * float64(life*12)
		fmt.Printf("Useful Life %d years: Required Depreciable Amount = Rp %.2f\n", life, requiredDepreciableAmount)
		
		// Contoh dengan salvage value 20%
		requiredPurchasePrice := requiredDepreciableAmount / 0.8 // 80% depreciable
		fmt.Printf("  -> Purchase Price (80%% depreciable): Rp %.2f\n", requiredPurchasePrice)
	}
	
	// Verifikasi untuk asset tertentu
	fmt.Println("\n--- Verifikasi Spesifik ---")
	// Asset dengan purchase price 42 juta, useful life 8 tahun, 1 bulan
	testPrice := 42000000.0
	testSalvage := 0.0
	testLife := 8
	testMonths := 1
	
	testDepreciable := testPrice - testSalvage
	testDepreciation := calculateStraightLineDepreciation(testDepreciable, testLife, testMonths)
	testMonthly := testDepreciable / float64(testLife*12)
	
	fmt.Printf("Test Asset - Price: Rp %.2f, Life: %d years, Months: %d\n", testPrice, testLife, testMonths)
	fmt.Printf("Monthly Depreciation: Rp %.2f\n", testMonthly)
	fmt.Printf("Accumulated Depreciation: Rp %.2f\n", testDepreciation)
	
	fmt.Println("\n=== Selesai ===")
}